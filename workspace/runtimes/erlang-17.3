#!/usr/bin/env bash
# Build Path: /app/.heroku/otp/

OUT_PREFIX=$1
TAG="OTP-17.3"

echo "Building Erlang/${TAG} to ${OUT_PREFIX}..."
SOURCE_TARBALL='https://github.com/erlang/otp/archive/${TAG}.tar.gz'
curl -L $SOURCE_TARBALL | tar xz

cd otp-${TAG}
for i in jinterface megaco; do
  touch lib/${i}/SKIP
  echo "Disabling ${i}"
done
./otp_build all -a ${OUT_PREFIX}

cd ..
rm -fr otp-${TAG}
